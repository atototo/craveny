# Story 2.6: telegram-bot

**Epic:** 2 - LLM ê¸°ë°˜ ì˜ˆì¸¡ ë° ì•Œë¦¼ ì‹œìŠ¤í…œ
**Status:** Draft

---

## Story

**As a** ì‚¬ìš©ì,
**I want** í…”ë ˆê·¸ë¨ì—ì„œ ë´‡ì„ ì¶”ê°€í•˜ê³  `/start` ëª…ë ¹ìœ¼ë¡œ êµ¬ë…ì„ ì‹œì‘í•˜ì—¬,
**so that** ì¤‘ìš” ë‰´ìŠ¤ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

---

## Acceptance Criteria

1. í…”ë ˆê·¸ë¨ ë´‡(`backend/telegram/bot.py`)ì´ python-telegram-botìœ¼ë¡œ êµ¬í˜„ëœë‹¤.
2. ë´‡ í† í°ì€ í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë¡œë“œí•œë‹¤.
3. `/start` ëª…ë ¹ ì²˜ë¦¬: user_idë¥¼ DBì— ì €ì¥í•˜ê³  í™˜ì˜ ë©”ì‹œì§€ ì „ì†¡
4. `/stop` ëª…ë ¹ ì²˜ë¦¬: is_activeë¥¼ falseë¡œ ì—…ë°ì´íŠ¸
5. `/help` ëª…ë ¹ ì²˜ë¦¬: ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ ì•ˆë‚´
6. ë´‡ì´ FastAPIì™€ ë³„ë„ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ëœë‹¤.
7. ë¡œì»¬ í…ŒìŠ¤íŠ¸: í…”ë ˆê·¸ë¨ì—ì„œ `/start` ì‹¤í–‰ â†’ í™˜ì˜ ë©”ì‹œì§€ ìˆ˜ì‹ 

---

## Tasks / Subtasks

- [ ] Task 1: í…”ë ˆê·¸ë¨ ë´‡ ì´ˆê¸°í™” (AC: 1, 2)
  - [ ] `backend/telegram/bot.py` ìƒì„±
  - [ ] Application ê°ì²´ ìƒì„±
  - [ ] í™˜ê²½ ë³€ìˆ˜ì—ì„œ TELEGRAM_BOT_TOKEN ë¡œë“œ

- [ ] Task 2: /start ëª…ë ¹ í•¸ë“¤ëŸ¬ (AC: 3)
  - [ ] start_command() í•¨ìˆ˜
  - [ ] user_id DB ì €ì¥ (TelegramUser ëª¨ë¸)
  - [ ] í™˜ì˜ ë©”ì‹œì§€ ì „ì†¡

- [ ] Task 3: /stop ëª…ë ¹ í•¸ë“¤ëŸ¬ (AC: 4)
  - [ ] stop_command() í•¨ìˆ˜
  - [ ] is_active=False ì—…ë°ì´íŠ¸

- [ ] Task 4: /help ëª…ë ¹ í•¸ë“¤ëŸ¬ (AC: 5)
  - [ ] help_command() í•¨ìˆ˜
  - [ ] ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ ì•ˆë‚´

- [ ] Task 5: ë´‡ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (AC: 6)
  - [ ] `scripts/run_telegram_bot.py` ìƒì„±
  - [ ] Application.run_polling() ì‚¬ìš©

- [ ] Task 6: FastAPI í†µí•©
  - [ ] ë³„ë„ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰
  - [ ] Supervisor ë˜ëŠ” systemd ì„¤ì • (ì„ íƒì‚¬í•­)

- [ ] Task 7: í…ŒìŠ¤íŠ¸ (AC: 7)
  - [ ] í…”ë ˆê·¸ë¨ì—ì„œ `/start` ì‹¤í–‰
  - [ ] í™˜ì˜ ë©”ì‹œì§€ í™•ì¸
  - [ ] DBì— user_id ì €ì¥ í™•ì¸

---

## Dev Notes

### Telegram Bot Implementation

```python
from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = str(update.effective_user.id)

    # DB ì €ì¥
    # ...

    await update.message.reply_text(
        "ğŸ“Š Craveny ë‰´ìŠ¤ ì•Œë¦¼ ë´‡ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!\n"
        "ì¤‘ìš” ì¦ê¶Œ ë‰´ìŠ¤ ì˜ˆì¸¡ ì•Œë¦¼ì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n"
        "/help - ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ ë³´ê¸°\n"
        "/stop - ì•Œë¦¼ êµ¬ë… í•´ì§€"
    )

def main():
    application = Application.builder().token(settings.TELEGRAM_BOT_TOKEN).build()

    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("stop", stop_command))
    application.add_handler(CommandHandler("help", help_command))

    application.run_polling()

if __name__ == "__main__":
    main()
```

### Testing

**Test Cases:**
1. `/start` â†’ í™˜ì˜ ë©”ì‹œì§€ ìˆ˜ì‹ 
2. DBì— user_id ì €ì¥ í™•ì¸
3. `/stop` â†’ is_active=False
4. `/help` â†’ ëª…ë ¹ì–´ ì•ˆë‚´

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-31 | 1.0 | Story created from Epic 2 | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

---

## QA Results

_To be populated by QA Agent_
