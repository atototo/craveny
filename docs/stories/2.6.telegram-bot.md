# Story 2.6: telegram-bot

**Epic:** 2 - LLM 기반 예측 및 알림 시스템
**Status:** Draft

---

## Story

**As a** 사용자,
**I want** 텔레그램에서 봇을 추가하고 `/start` 명령으로 구독을 시작하여,
**so that** 중요 뉴스 알림을 받을 수 있다.

---

## Acceptance Criteria

1. 텔레그램 봇(`backend/telegram/bot.py`)이 python-telegram-bot으로 구현된다.
2. 봇 토큰은 환경 변수에서 로드한다.
3. `/start` 명령 처리: user_id를 DB에 저장하고 환영 메시지 전송
4. `/stop` 명령 처리: is_active를 false로 업데이트
5. `/help` 명령 처리: 사용 가능한 명령어 안내
6. 봇이 FastAPI와 별도 프로세스로 실행된다.
7. 로컬 테스트: 텔레그램에서 `/start` 실행 → 환영 메시지 수신

---

## Tasks / Subtasks

- [ ] Task 1: 텔레그램 봇 초기화 (AC: 1, 2)
  - [ ] `backend/telegram/bot.py` 생성
  - [ ] Application 객체 생성
  - [ ] 환경 변수에서 TELEGRAM_BOT_TOKEN 로드

- [ ] Task 2: /start 명령 핸들러 (AC: 3)
  - [ ] start_command() 함수
  - [ ] user_id DB 저장 (TelegramUser 모델)
  - [ ] 환영 메시지 전송

- [ ] Task 3: /stop 명령 핸들러 (AC: 4)
  - [ ] stop_command() 함수
  - [ ] is_active=False 업데이트

- [ ] Task 4: /help 명령 핸들러 (AC: 5)
  - [ ] help_command() 함수
  - [ ] 사용 가능한 명령어 안내

- [ ] Task 5: 봇 실행 스크립트 (AC: 6)
  - [ ] `scripts/run_telegram_bot.py` 생성
  - [ ] Application.run_polling() 사용

- [ ] Task 6: FastAPI 통합
  - [ ] 별도 프로세스로 실행
  - [ ] Supervisor 또는 systemd 설정 (선택사항)

- [ ] Task 7: 테스트 (AC: 7)
  - [ ] 텔레그램에서 `/start` 실행
  - [ ] 환영 메시지 확인
  - [ ] DB에 user_id 저장 확인

---

## Dev Notes

### Telegram Bot Implementation

```python
from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = str(update.effective_user.id)

    # DB 저장
    # ...

    await update.message.reply_text(
        "📊 Craveny 뉴스 알림 봇에 오신 것을 환영합니다!\n"
        "중요 증권 뉴스 예측 알림을 받으실 수 있습니다.\n\n"
        "/help - 사용 가능한 명령어 보기\n"
        "/stop - 알림 구독 해지"
    )

def main():
    application = Application.builder().token(settings.TELEGRAM_BOT_TOKEN).build()

    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("stop", stop_command))
    application.add_handler(CommandHandler("help", help_command))

    application.run_polling()

if __name__ == "__main__":
    main()
```

### Testing

**Test Cases:**
1. `/start` → 환영 메시지 수신
2. DB에 user_id 저장 확인
3. `/stop` → is_active=False
4. `/help` → 명령어 안내

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-31 | 1.0 | Story created from Epic 2 | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

---

## QA Results

_To be populated by QA Agent_
