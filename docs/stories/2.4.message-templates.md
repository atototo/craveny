# Story 2.4: message-templates

**Epic:** 2 - LLM 기반 예측 및 알림 시스템
**Status:** Draft

---

## Story

**As a** 시스템,
**I want** 시간대에 따라 다른 구조의 텔레그램 메시지를 생성하여,
**so that** 사용자에게 상황별 최적의 투자 전략을 제공할 수 있다.

---

## Acceptance Criteria

1. 메시지 생성 함수(`backend/telegram/message_builder.py`)가 구현된다.
2. 입력: 예측 결과, 시간대, 뉴스 정보, 주가 정보
3. 프리마켓 템플릿이 예상 시가, 동시호가 전략, 과거 패턴, 전략 옵션을 포함한다.
4. 장중 템플릿이 현재가, 뉴스 반영도(%), 추가 상승 여력, 진입 타이밍을 포함한다.
5. 장후 템플릿이 다음날 예상 시가, 준비 사항, 목표가/손절가를 포함한다.
6. 모든 메시지는 텔레그램 마크다운 포맷을 사용한다.
7. 이모지 사용 규칙을 준수한다.
8. 메시지 길이가 500~800자 범위로 제한된다.
9. 메시지 끝에 면책 조항이 포함된다.
10. 로컬 테스트: 각 시간대별 샘플 데이터로 올바른 포맷이 반환된다.

---

## Tasks / Subtasks

- [ ] Task 1: 메시지 빌더 함수 (AC: 1, 2)
  - [ ] `backend/telegram/message_builder.py` 생성
  - [ ] build_telegram_message() 함수

- [ ] Task 2: 프리마켓 템플릿 (AC: 3)
  - [ ] pre_market_template() 함수
  - [ ] 예상 시가, 동시호가 전략 포함

- [ ] Task 3: 장중 템플릿 (AC: 4)
  - [ ] intraday_template() 함수
  - [ ] 현재가, 뉴스 반영도, 진입 타이밍

- [ ] Task 4: 장후 템플릿 (AC: 5)
  - [ ] post_market_template() 함수
  - [ ] 다음날 예상, 목표가/손절가

- [ ] Task 5: 마크다운 포맷팅 (AC: 6, 7)
  - [ ] 텔레그램 마크다운 적용
  - [ ] 이모지 규칙 준수 (📊, 🗞️, 📈, 📉)

- [ ] Task 6: 메시지 길이 제한 (AC: 8, 9)
  - [ ] 500-800자 검증
  - [ ] 면책 조항 추가

- [ ] Task 7: 테스트 (AC: 10)
  - [ ] 각 시간대 샘플 메시지 생성
  - [ ] 포맷 검증

---

## Dev Notes

### PRD Message Example (PRD Line 238-262 참고)

```
📊 *SK하이닉스* 중요 뉴스 알림 (07:15)

🗞️ "SK하이닉스, 엔비디아와 HBM3 독점 공급 계약 체결"
📅 뉴스 발표: 07:00
⏰ 장 시작까지: 1시간 45분

📈 AI 예측:
- 전날 종가: 142,500원
- *예상 시가: 148,000~150,000원 (+3.9~5.3%)*
- 상승 지속 확률: *78%* (3~5일간)
- 영향도 점수: *8.5/10*

⚠️ 프리마켓 전략:
- 추천: 동시호가 관망 후 9:05~9:30 진입
- 이유: 시초가 과열 가능성, 초반 조정 후 재상승 패턴

📊 과거 패턴:
- 유사 뉴스 시초가 평균: +4.2%
- 이후 재상승 확률: 83%

_본 정보는 투자 조언이 아니며, 최종 투자 결정은 본인 책임입니다._
```

### Testing

**Test Cases:**
1. 프리마켓 메시지 생성
2. 장중 메시지 생성
3. 장후 메시지 생성
4. 메시지 길이 500-800자
5. 마크다운 포맷 검증

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-31 | 1.0 | Story created from Epic 2 | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

---

## QA Results

_To be populated by QA Agent_
