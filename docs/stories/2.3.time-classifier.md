# Story 2.3: time-classifier

**Epic:** 2 - LLM 기반 예측 및 알림 시스템
**Status:** Draft

---

## Story

**As a** 시스템,
**I want** 뉴스 발표 시간을 기준으로 프리마켓/장중/장후를 자동 판별하여,
**so that** 시간대별 맞춤 전략을 제공할 수 있다.

---

## Acceptance Criteria

1. 시간대 판별 함수(`backend/llm/time_classifier.py`)가 구현된다.
2. 입력: 뉴스 발표 시간, 출력: "PRE_MARKET" | "INTRADAY" | "POST_MARKET"
3. 판별 기준:
   - PRE_MARKET: 00:00 ~ 08:59
   - INTRADAY: 09:00 ~ 15:29
   - POST_MARKET: 15:30 ~ 23:59
4. 주말/공휴일은 POST_MARKET으로 처리한다.
5. 한국 시간대(KST) 기준으로 판별한다.
6. 로컬 테스트: 다양한 시간대 입력 시 올바른 분류가 반환된다.

---

## Tasks / Subtasks

- [ ] Task 1: 시간대 Enum 정의 (AC: 2)
  - [ ] MarketTimeType Enum 생성
  - [ ] PRE_MARKET, INTRADAY, POST_MARKET

- [ ] Task 2: 시간대 판별 함수 (AC: 1, 3, 5)
  - [ ] `backend/llm/time_classifier.py` 작성
  - [ ] classify_market_time() 함수
  - [ ] KST 시간대 처리 (pytz)

- [ ] Task 3: 주말/공휴일 처리 (AC: 4)
  - [ ] is_weekend() 함수
  - [ ] 주말 → POST_MARKET

- [ ] Task 4: 테스트 (AC: 6)
  - [ ] 프리마켓 시간 테스트
  - [ ] 장중 시간 테스트
  - [ ] 장후 시간 테스트
  - [ ] 주말 테스트

---

## Dev Notes

### Implementation

```python
from datetime import datetime
from enum import Enum
import pytz

class MarketTimeType(str, Enum):
    PRE_MARKET = "PRE_MARKET"
    INTRADAY = "INTRADAY"
    POST_MARKET = "POST_MARKET"

def classify_market_time(published_at: datetime) -> MarketTimeType:
    kst = pytz.timezone('Asia/Seoul')
    kst_time = published_at.astimezone(kst)

    # 주말
    if kst_time.weekday() >= 5:
        return MarketTimeType.POST_MARKET

    hour = kst_time.hour
    minute = kst_time.minute

    if hour < 9:
        return MarketTimeType.PRE_MARKET
    elif hour < 15 or (hour == 15 and minute < 30):
        return MarketTimeType.INTRADAY
    else:
        return MarketTimeType.POST_MARKET
```

### Testing

**Test Cases:**
1. 07:30 → PRE_MARKET
2. 10:00 → INTRADAY
3. 16:00 → POST_MARKET
4. 토요일 → POST_MARKET

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-31 | 1.0 | Story created from Epic 2 | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

---

## QA Results

_To be populated by QA Agent_
